<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>The Fundamentals of Functional Programming</title>
    <meta name="author" content="Steve Klabnik" />
    <link href="http://feeds2.feedburner.com/SteveKlabnik" rel="alternate" title="Steve Klabnik" type="application/atom+xml" />

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

    <!-- Homepage CSS -->
    <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

  </head>
  <body>

    <div class="site" id="main">
      <div class="title">
        <a href="/">Steve Klabnik</a>
        <a class="extra" href="/">home</a>
      </div>

      <div id="post">
  <h1>The Fundamentals of Functional Programming</h1>
<p class="meta">17 Mar 2009</p>
<p>There&#8217;s been quite a bit of talk on the Internet recently about functional programming. Most people get exposed to procedural programming and object oriented programming, but fewer learn about the functional paradigm. This does not mean that it&#8217;s without use, nor that one needs to learn all about functional programming in order to take advantage of its philosophies. We can easily apply quite a few functional concepts to many different languages, and as a result, our code can be cleaner and easier to understand.</p>
<h2>The Functional Gospel</h2>
<p>Procedural Programming is obsessed with structure. Its rallying cry is that we need to break our code into small submodules. This gives us numerous advantages which everyone is quite familliar with. Object Oriented Programming is all about objects (or messages, depending on who you talk to) and their ability to abstract away details. The interaction between classes is the guiding principle of strucutre. Functional Programming is centered around functions, but in a slightly different way than either of the previous two. It thinks of functions in the same way that mathematics does. This is actually quite similar to the Unix Philosophy. From Doug McIllroy:</p>
<blockquote>
<p>Make each program do one thing well. To do a new job, build afresh rather than complicate old programs by adding new features.<br />
Expect the output of every program to become the input to another, as yet unknown, program. Don&#8217;t clutter output with extraneous information. Avoid stringently columnar or binary input formats. Don&#8217;t insist on interactive input.</p>
</blockquote>
<p>Functional Programming thinks of every part of your program in this manner. Programs are a collection of functions, and functions are filters. They associate one element of a set to a single output of another set. We take in input, and spit out ouput. Likewise, so does each function within a program. Every function accepts something and returns something. Functions transform sets, and we&#8217;re trying to achieve the transformation from our input set to our answer set, through manipulating several sets in between.</p>
<p>When you think about programs in this manner, you can see that Functional Programming&#8217;s goals are not really different from either Procedural&#8217;s or Object Oriented&#8217;s. Each of them are trying to achieve the same goal: make your programs easier to understand by splitting it up into smaller and smaller chunks. Make the chunks play nicely with each other, and you&#8217;re in business.</p>
<p>Now, some problems are really easy to think about in this manner, and some are not. While it&#8217;s a fun mental exercise to attempt to solve everything in a purely functional way, most of the time, people are just trying to get things done. No matter if it&#8217;s due to a work deadline or a project due date, most people just want to accpomplish things. In this situation, a hybrid approach is best. Luckily, more languages are including interesting functional bits to their core, and so writing code in this manner is easier and easier to do. Let&#8217;s explore two of the most fundamental types of functions, and how we can use them in &#8216;normal&#8217; languages.</p>
<h2>Types: An Interlude</h2>
<p>Recognizing patterns is a really useful ability. This is one of the reasons that we write functions in the first place; when we see a pattern of code repeating, we abstract that code away, give it a name, and use it over and over again. Some languages play fast and loose with typing information, and others are quite strict. However, thinking about types is a great way to structure your code.</p>
<p>Now, I&#8217;m not saying that strong static typing is always the way to go. However, we can examine type signatures of functions and learn a great deal about how they operate. For instance, let&#8217;s think about a function &#8216;foo&#8217;. We&#8217;ll use Ruby for our example, but any language will do, really.</p>
<div>
<pre>
<code class='ruby'>def foo(bar)
for i in 0 &#8230; bar.length do
bar[i] += 1
end
return bar
<p>end</p>
<p>baz = [1,2,3,4,5]</p>
<p>puts baz<br />
baz = foo(baz)<br />
puts baz</code><br />
  </pre></p>
</div>
<p>Now, this function is pretty easy to understand. It takes each element of the loop and increments it by one. However, we can make the intentions of our function more clear. When you use a well defined and well known pattern, it enhances your code. Other people will be able to read it easier, because they&#8217;ve seen the pattern in use before, and therefore they already have an intuition about how it works.</p>
<p>This function takes in a list, and outputs a list. We have a special name for this kind of function. A pattern, if you will. It&#8217;s called &#8216;map.&#8217;</p>
<h2>Map</h2>
<p>Maps are the most fundamental kind of function. As I just said, they take a list of things and spit out another list of things. They&#8217;re really important, because this is how math functions work, and they&#8217;re also the easiest to understand. Let&#8217;s examine the above function written as a map:</p>
<div>
<pre>
<code class='ruby'>baz = [1,2,3,4,5]
<p>puts baz<br />
baz = baz.map { | i | i += 1 }<br />
puts bar</code><br />
  </pre></p>
</div>
<p>Whoa! At first this seems pretty crazy, but it&#8217;s really not that bad. Let&#8217;s see that in a few other languages&#8230; see if you can recognize any of them.</p>
<div>
<pre>
<code class='python'>def plusOne(val):
return val+1
<p>baz = [1,2,3,4,5]<br />
baz = map(plusOne, baz)</code><br />
  </pre></p>
</div>
<p>How about this?</p>
<div>
<pre>
<code class='perl'>@baz = (1,2,3,4,5);
<p>@baz = map { $_ + 1 } @baz ;</code><br />
  </pre></p>
</div>
<p>Maybe this? It&#8217;s pretty easy, due to the tag&#8230;</p>
<div>
<pre>
<code class='php'>&amp;lt;?php
<p>$baz = array(1,2,3,4,5);<br />
$addOne = create_function(&#8216;$a&#8217;, &#8216;return $a + 1;&#8217;);<br />
$baz = array_map($addOne, $baz);<br />
?&gt;</code><br />
  </pre></p>
</div>
<p>or soon:</p>
<div>
<pre>
<code class='php'>&amp;lt;?
<p>$baz = array(1,2,3,4,5);<br />
$addOne = function($x) { return $x + 1; }<br />
$baz = array_map($addOne, $baz);<br />
?&gt;</code><br />
  </pre></p>
</div>
<p>And finally&#8230;</p>
<div>
<pre>
<code class='haskell'>baz :: [a] -&amp;gt; [a]
<p>baz = map (+1)</code><br />
  </pre></p>
</div>
<p>Now, as you can see, many different langauges support this kind of construct. Let&#8217;s see how many you got correct:</p>
<ol>
	<li>Python</li>
	<li>Perl</li>
	<li><span class="caps">PHP</span></li>
	<li><span class="caps">PHP</span> 5.3</li>
	<li>Haskell</li>
</ol>
<p>However, lots of these langauges sneak in a map function under a totally different construct. I bet you&#8217;ll recognize this syntax a bit more:</p>
<div>
<pre>
<code class='java'>import java.util.ArrayList;
<p>import java.util.Arrays;</p>
<p>class Temp {</p>
public static void main(String[] args) {
Integer [] temp = { 1, 2, 3, 4, 5};
ArrayList&lt;Integer&gt; baz = new ArrayList&lt;Integer&gt;(
Arrays.asList(temp));
ArrayList&lt;Integer&gt; bar = new ArrayList&lt;Integer&gt;();
for(int i : baz) {
bar.add(i + 1);
}
System.out.println(bar);
}
<p>}</code><br />
  </pre></p>
</div>
<p>Maybe here?</p>
<div>
<pre>
<code class='perl'>@baz = (1,2,3,4,5);
<p>foreach (@baz) {<br />
  $_ +=1;<br />
}<br />
print @baz;</code><br />
  </pre></p>
</div>
<p>Or this:</p>
<div>
<pre>
<code class='php'>&amp;lt;?php
<p>$baz = array(1,2,3,4,5);<br />
foreach($baz as $x) {<br />
  $x += 1;<br />
}<br />
var_dump($baz);<br />
?&gt;</code><br />
  </pre></p>
</div>
<p>This?</p>
<div>
<pre>
<code class='python'>baz = [1,2,3,4,5]
<p>for x in baz:<br />
  x += 1</code><br />
  </pre></p>
</div>
<p>Yep. Foreach is a map. They&#8217;re the exact same thing. It&#8217;s just that the name &#8216;foreach&#8217; draws the parallel to our buddy &#8216;for&#8217;, which is a more clumsy version of a foreach.</p>
<p>A little bit of type stuff: map converts one list to another, via a function that takes in one thing and returns one thing. We take each element of the first set, put it through the one to one function to get the element of the other set. If you think about it, this is exactly what the code above does. You take this:</p>
<div>
<pre>
<code class='java'>foreach(int i: is) {
&lt;body code goes here&gt;
<p>}</code><br />
  </pre></p>
</div>
<p>And do this&#8230;</p>
<div>
<pre>
<code class='java'>foreach(int i: is) {
f(i);
<p>}<br />
void f(int i) {<br />
  &lt;body code goes here&gt;<br />
}</code><br />
  </pre></p>
</div>
<p>Now that looks a bit more like our map, doesn&#8217;t it?</p>
<p>See how easy functional style programming is?</p>
<h2>Reduce</h2>
<p>Reduce is another fundamental kind of function. Like map, it operates on lists. Unlike map, it returns a single value. As an arbitrary example, let&#8217;s sum up the numbers from 1 to 10:</p>
<div>
<pre>
<code class='ruby'>(1..10).reduce {|sum, number| sum += number}</code>
</pre>
</div>
<p>Whoa! Our function takes two arguments, &#8216;sum&#8217; and &#8216;number&#8217;, and returns a single value. Note how we add number to sum? We&#8217;re reducing the amount of numbers in our list, until we get the whole way down to 1. Any sort of transformation from many to one can be written as a fold.</p>
<h2>An Example</h2>
<p>Here&#8217;s an example of code written in this style. This is from some actual code that I wrote the other day; the objective is to turn an array of statistics into the xml that&#8217;s needed for a chart software suite&#8217;s configuration. It lists the top n things, their percentage of the total, and the bottom things grouped together under &#8216;other.&#8217; PHP&#8217;s syntax is a bit clumsy, but it still gets the idea across.</p>
<div>
<pre>
<code class='php'>&amp;lt;?php
<p>// spit out the xml we need for the chart by computing<br />
// the percentages from $stats.<br />
//<br />
// the final chart consists of the label for each of the top n<br />
// parts, and then the remainder of them under &quot;Other&quot;<br />
//<br />
// $stats[&#8216;datasets&#8217;][n] looks like this:<br />
//array<br />
//  &#8216;label&#8217; =&gt; string &#8216;US&#8217; (length=2)<br />
//  &#8216;total_count&#8217; =&gt; int 111519098<br />
//  &#8216;filtered_count&#8217; =&gt; int 62279230<br />
//  &#8216;completed_count&#8217; =&gt; int 88155295<br />
//  &#8216;bytes_delivered&#8217; =&gt; int 2147483647<br />
//  &#8216;gb_delivered&#8217; =&gt; float 2</p>
<p>//we want to get the top n things.<br />
//feel free to change n to adjust things how you&#8217;d like them.<br />
$n = 5;</p>
<p>//get the top n bits of data<br />
$top = range(0, $n &#8211; 1);<br />
$top = array_combine($top, array_slice($stats[&#8216;datasets&#8217;], 0, $n));</p>
<p>//now, only grab the stuff that we actually need<br />
array_walk($top, create_function(&#8216;&amp;$a&#8217;,<br />
      &#8216;$a = array(&quot;label&quot; =&gt; $a[&quot;label&quot;],&#8217; .<br />
        &#8217;        &quot;filtered_count&quot; =&gt; $a[&quot;filtered_count&quot;]);&#8217;<br />
      )<br />
    );</p>
<p>//grab out the filtered count<br />
$filter_count = create_function(&#8216;$a&#8217;,<br />
    &#8216;return $a[&quot;filtered_count&quot;];&#8217;);<br />
$all_counts = array_map($filter_count, $stats[&#8216;datasets&#8217;]);<br />
$top_counts = array_map($filter_count, $top);</p>
<p>//sum all of that up<br />
$sum_func = create_function(&#8216;$acc, $val&#8217;,<br />
    &#8216;$acc += $val; return $acc;&#8217;<br />
    );<br />
$total_sum = array_reduce($all_counts, $sum_func);<br />
$top_sum  = array_reduce($top_counts, $sum_func);</p>
<p>//the sum of everything but the fifth is the total sum minus the<br />
//top 5 sum<br />
$other_count = $total_sum &#8211; $top_sum;</p>
<p>//now we can add it to our top count data<br />
$top[$n][&#8216;label&#8217;] = &quot;Other&quot;;<br />
$top[$n][&#8216;filtered_count&#8217;] = $other_count;</p>
<p>//add the extra sum to the top 5 sum<br />
array_push($top_counts, $other_count);</p>
<p>//this function converts each element to the percentage of the total<br />
$convert_to_percent = create_function(&#8216;$a&#8217;,<br />
    &#8216;return round( 100 *$a / &#8217; . $total_sum . &#8217;);&#8217;<br />
    );<br />
$percents = array_map($convert_to_percent, $top_counts);</p>
<p>//this function merges the values from our top and percent arrays<br />
//into a structure that we can actually use<br />
$combine_data = create_function(&#8216;$a, $b&#8217;,<br />
    &#8216;return array(&quot;title&quot; =&gt; $a[&quot;label&quot;], &quot;percentage&quot; =&gt; $b );&#8217;<br />
    );<br />
$data = array_map($combine_data, $top, $percents);</p>
<p>header(&quot;Content-type: application/xml&quot;);</p>
<p>echo &#8216;&lt;?xml version=&quot;1.0&quot; encoding=&quot;<span class="caps">UTF</span>-8&quot;?&gt;&#8217;;<br />
echo &#8216;&lt;pie&gt;&#8217;;<br />
//spit out the first slice with pull_out = true<br />
$first = array_shift($data);<br />
echo &#8217;    &lt;slice title=&quot;&#8217; . $first[&#8216;title&#8217;] .<br />
     &#8216;&quot; pull_out=&quot;true&quot;&gt;&#8217; . $first[&#8216;percentage&#8217;] .<br />
     &#8216;&lt;/slice&gt;&#8217;;</p>
<p>//print out the rest of the slices<br />
$print_slice = create_function(&#8216;$a&#8217;,<br />
    &#8216;echo &quot;    &lt;slice title=\&quot;&quot; . $a[&quot;title&quot;] . &quot;\&quot;&gt;&quot; .<br />
    $a[&quot;percentage&quot;] . &quot;&lt;/slice&gt;&quot;;&#8217;);<br />
array_walk($data, $print_slice);<br />
echo &#8216;&lt;/pie&gt;&#8217;;<br />
?&gt;</code><br />
  </pre></p>
</div>
<p>And there we are. A real example of using functional principles in <span class="caps">PHP</span>.</p>
</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
    <li><span>25 Aug 2009</span> &raquo; <a href="/2009/08/25/art-vs-science.html">Art vs. Science</a></li>
    
    <li><span>18 Aug 2009</span> &raquo; <a href="/2009/08/18/2009-beautiful-code.html">Beautiful Code</a></li>
    
  </ul>
</div>

<div>
	<div id="disqus_thread"></div><script type="text/javascript" src="http://disqus.com/forums/steveklabniksblog/embed.js"></script><noscript><a href="http://steveklabniksblog.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
	<script type="text/javascript">
		//<![CDATA[
		(function() {
				var links = document.getElementsByTagName('a');
					var query = '?';
						for(var i = 0; i < links.length; i++) {
								if(links[i].href.indexOf('#disqus_thread') >= 0) {
											query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
												}
													}
														document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/steveklabniksblog/get_num_replies.js' + query + '"></' + 'script>');
														})();
														//]]>
													</script>
</div>


      <div class="footer">
        <div class="contact">
          <p>
          Steve Klabnik<br />
          </p>
          <p>Powered by <a href="http://github.com/mojombo/jekyll/tree/master">jekyll</a></p>
        </div>
        <div class="contact">
          <p>
          <a href="mailto:steve@steveklabnik.com">steve@steveklabnik.com</a>
          </p>
        </div>
        <div class="rss">
          <a href="http://feeds2.feedburner.com/SteveKlabnik">
            <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
          </a>
        </div>
      </div>
    </div>

<!--
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      </script>
      <script type="text/javascript">
        var pageTracker = _gat._getTracker("UA-10289851-1");
        pageTracker._trackPageview();
        </script>

        -->
      </body>
    </html>

